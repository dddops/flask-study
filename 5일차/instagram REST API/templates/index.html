<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram API í´ë¼ì´ì–¸íŠ¸</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; padding: 20px; max-width: 800px; margin: auto; background-color: #f0f2f5; }
        h1, h2 { color: #1c1e21; }
        .container { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .user-card { border: 1px solid #ddd; padding: 15px; margin-bottom: 15px; border-radius: 8px; }
        .post { margin-left: 20px; padding: 10px; border-left: 3px solid #e7e7e7; }
        input[type="text"], button { padding: 8px 12px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #007bff; color: white; border-color: #007bff; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .delete-btn { background-color: #dc3545; border-color: #dc3545; }
        .delete-btn:hover { background-color: #c82333; }
        .like-btn { background-color: #28a745; border-color: #28a745; margin-left: 10px; }
        .like-btn:hover { background-color: #218838; }
        form { margin-top: 10px; padding: 10px; background-color: #f8f9fa; border-radius: 5px; }
    </style>
</head>
<body>

    <h1>ğŸ“· Instagram API í´ë¼ì´ì–¸íŠ¸</h1>

    <div class="container">
        <h2>ì‚¬ìš©ì ëª©ë¡</h2>
        <button onclick="fetchUsers()">ì‚¬ìš©ì ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
        <div id="users-list"></div>
    </div>

    <div class="container">
        <h2>ìƒˆ ì‚¬ìš©ì ì¶”ê°€</h2>
        <form id="createUserForm">
            <input type="text" id="new-username" placeholder="ìƒˆ ì‚¬ìš©ì ì´ë¦„" required>
            <button type="submit">ì‚¬ìš©ì ìƒì„±</button>
        </form>
    </div>

    <div class="container">
        <h2>ìƒˆ ê²Œì‹œë¬¼ ì¶”ê°€</h2>
        <form id="createPostForm">
            <input type="text" id="post-username" placeholder="ê²Œì‹œë¬¼ ì˜¬ë¦´ ì‚¬ìš©ì ì´ë¦„" required>
            <input type="text" id="post-title" placeholder="ê²Œì‹œë¬¼ ì œëª©" required>
            <button type="submit">ê²Œì‹œë¬¼ ì¶”ê°€</button>
        </form>
    </div>

    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‚¬ìš©ì ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
        document.addEventListener('DOMContentLoaded', fetchUsers);

        // ëª¨ë“  ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì™€ì„œ í™”ë©´ì— í‘œì‹œí•˜ëŠ” í•¨ìˆ˜
        async function fetchUsers() {
            const response = await fetch('/users');
            const data = await response.json();
            const usersListDiv = document.getElementById('users-list');
            usersListDiv.innerHTML = ''; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

            data.users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';

                let postsHtml = '';
                user.posts.forEach(post => {
                    postsHtml += `
                        <div class="post">
                            <strong>${post.title}</strong> (â¤ï¸ ${post.likes})
                            <button class="like-btn" onclick="likePost('${user.username}', '${post.title}')">ì¢‹ì•„ìš”</button>
                        </div>
                    `;
                });

                userCard.innerHTML = `
                    <h3>
                        ${user.username}
                        <button class="delete-btn" onclick="deleteUser('${user.username}')">ì‚­ì œ</button>
                    </h3>
                    <div>${postsHtml || '<p>ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}</div>
                `;
                usersListDiv.appendChild(userCard);
            });
        }

        // ìƒˆ ì‚¬ìš©ì ìƒì„± í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('createUserForm').addEventListener('submit', async (e) => {
            e.preventDefault(); // í¼ì˜ ê¸°ë³¸ ì œì¶œ ë™ì‘(í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨) ë°©ì§€
            const username = document.getElementById('new-username').value;

            const response = await fetch('/users', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username: username })
            });

            if (response.ok) {
                alert(`ì‚¬ìš©ì '${username}'ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                document.getElementById('new-username').value = '';
                fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else {
                alert('ì‚¬ìš©ì ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ìƒˆ ê²Œì‹œë¬¼ ì¶”ê°€ í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('createPostForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('post-username').value;
            const title = document.getElementById('post-title').value;

            const response = await fetch(`/users/post/${username}`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title: title, likes: 0 }) // ìƒˆ ê²Œì‹œë¬¼ì€ ì¢‹ì•„ìš” 0ê°œë¡œ ì‹œì‘
            });

            if (response.ok) {
                alert(`'${username}' ì‚¬ìš©ìì˜ ê²Œì‹œë¬¼ '${title}'ì´(ê°€) ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                document.getElementById('post-username').value = '';
                document.getElementById('post-title').value = '';
                fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else {
                alert('ê²Œì‹œë¬¼ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
            }
        });

        // ê²Œì‹œë¬¼ 'ì¢‹ì•„ìš”' ê¸°ëŠ¥
        async function likePost(username, title) {
            const response = await fetch(`/users/post/like/${username}/${title}`, {
                method: 'PUT'
            });

            if (response.ok) {
                fetchUsers(); // ê°„ë‹¨í•˜ê²Œ ëª©ë¡ ì „ì²´ë¥¼ ìƒˆë¡œê³ ì¹¨
            } else {
                alert('ì¢‹ì•„ìš” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‚¬ìš©ì ì‚­ì œ ê¸°ëŠ¥
        async function deleteUser(username) {
            if (!confirm(`ì •ë§ë¡œ '${username}' ì‚¬ìš©ìë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                return;
            }

            const response = await fetch(`/users/${username}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                alert(`'${username}' ì‚¬ìš©ìê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                fetchUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            } else {
                alert('ì‚¬ìš©ì ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>

</body>
</html>
